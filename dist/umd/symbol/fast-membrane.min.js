!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).FastMembrane=t()}(this,function(){"use strict";const e=Symbol("object_to_reactive-proxy"),t=Symbol("reactive-proxy_to_object");class r{constructor({getProxyfiedValue:e,valueMutated:t,valueObserved:r}){this.valueMutated=null,this.valueObserved=null,this.getProxyfiedValue=e,this.valueMutated=t,this.valueObserved=r}get(e,r){if(r===t)return e;null!==this.valueObserved&&this.valueObserved(e,r);const u=e[r];return this.getProxyfiedValue(u)}getOwnPropertyDescriptor(e,t){null!==this.valueObserved&&this.valueObserved(e,t);const r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r)return;const{value:u}=r;if(void 0!==u)r.value=this.getProxyfiedValue(u);else{const{get:t}=r;void 0!==t&&(r.get=(()=>this.getProxyfiedValue(t.call(e))))}return r}set(e,t,r){return e[t]=r,null!==this.valueMutated&&this.valueMutated(e,t),!0}deleteProperty(e,t){return delete e[t],null!==this.valueMutated&&this.valueMutated(e,t),!0}has(e,t){const r=t in e;return null!==this.valueMutated&&this.valueMutated(e,t),r}defineProperty(e,t,r){const u=Object.defineProperty(e,t,r);return null!==this.valueMutated&&this.valueMutated(e,t),u}setPrototypeOf(){return!1}preventExtensions(){return!1}}const{isArray:u}=Array,{getPrototypeOf:l,isFrozen:o,prototype:n}=Object;return class{constructor(i){let s=null,a=null;void 0!==i&&(void 0!==i.valueMutated&&(s=i.valueMutated),void 0!==i.valueObserved&&(a=i.valueObserved));const d=this.getProxyfiedValue=(r=>{if(!function(e){if(null===e)return!1;if("object"!=typeof e)return!1;if(!0===u(e))return!0;if(void 0!==e[t])return!1;const r=l(e);return 0!=(null===r||r===n||null===l(r))&&!1===o(e)}(r))return r;let i=r[e];return void 0===i&&(i=new Proxy(r,this.reactiveProxy),r[e]=i),i});this.reactiveProxy=new r({valueMutated:s,valueObserved:a,getProxyfiedValue:d})}getProxy(e){return this.getProxyfiedValue(e)}getReadOnlyProxy(e){return this.getProxyfiedValue(e)}unwrapProxy(e){const r=e[t];return void 0!==r?r:e}}});
