!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).FastMembrane=t()}(this,function(){"use strict";class e{constructor({getProxyfiedValue:e,valueMutated:t,valueObserved:r}){this.valueMutated=null,this.valueObserved=null,this.getProxyfiedValue=e,this.valueMutated=t,this.valueObserved=r}get(e,t){null!==this.valueObserved&&this.valueObserved(e,t);const r=e[t];return this.getProxyfiedValue(r)}getOwnPropertyDescriptor(e,t){null!==this.valueObserved&&this.valueObserved(e,t);const r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r)return;const{value:u}=r;if(void 0!==u)r.value=this.getProxyfiedValue(u);else{const{get:t}=r;void 0!==t&&(r.get=(()=>this.getProxyfiedValue(t.call(e))))}return r}set(e,t,r){return e[t]=r,null!==this.valueMutated&&this.valueMutated(e,t),!0}deleteProperty(e,t){return delete e[t],null!==this.valueMutated&&this.valueMutated(e,t),!0}has(e,t){const r=t in e;return null!==this.valueMutated&&this.valueMutated(e,t),r}defineProperty(e,t,r){const u=Object.defineProperty(e,t,r);return null!==this.valueMutated&&this.valueMutated(e,t),u}setPrototypeOf(){return!1}preventExtensions(){return!1}}const{isArray:t}=Array,{getPrototypeOf:r,isFrozen:u,prototype:o}=Object;return class{constructor(i){this.objectToReactiveProxy=new WeakMap,this.reactiveProxyToObject=new WeakMap;let s=null,a=null;void 0!==i&&(void 0!==i.valueMutated&&(s=i.valueMutated),void 0!==i.valueObserved&&(a=i.valueObserved));const l=this.getProxyfiedValue=(e=>{if(!function(e){if(null===e)return!1;if("object"!=typeof e)return!1;if(!0===t(e))return!0;const i=r(e);return 0!=(null===i||i===o||null===r(i))&&!1===u(e)}(e))return e;let i=this.objectToReactiveProxy.get(e);return void 0===i&&(i=new Proxy(e,this.reactiveProxy),this.objectToReactiveProxy.set(e,i),this.reactiveProxyToObject.set(i,e)),i});this.reactiveProxy=new e({valueMutated:s,valueObserved:a,getProxyfiedValue:l})}getProxy(e){return this.reactiveProxyToObject.has(e)?e:this.getProxyfiedValue(e)}getReadOnlyProxy(e){return this.getProxyfiedValue(e)}unwrapProxy(e){const t=this.reactiveProxyToObject.get(e);return void 0!==t?t:e}}});
